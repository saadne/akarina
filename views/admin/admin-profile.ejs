<!DOCTYPE html>
<html lang="en">

<%- include('../partiels/head.ejs')%>

    <body>
        <%- include('../partiels/nav.ejs')%>
            <div class="container" style="margin-top: 3rem;">
                <table class="table table-striped table-dark">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nom</th>
                            <th scope="col">Numero</th>
                            <th scope="col">Email</th>
                            <th scope="col">Role</th>
                            <th scope="col">Propieties</th>
                            <th scope="col">Operations</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (users.length> 0) { %>
                            <% users.forEach((user)=> { %>

                                <tr>
                                    <th scope="row">1</th>
                                    <td>
                                        <%= user.name %>
                                    </td>
                                    <td>
                                        <%= user.phone %>
                                    </td>
                                    <td>
                                        <%= user.email %>
                                    </td>

                                    <td>
                                        <%= user.role %>
                                    </td>
                                    <td>
                                        <a href="/admin/user-propertys/<%= user.id %>">click</a>
                                    </td>

                                    <td>
                                        <div class="buttons">
                                            <a href="/admin/update-user/<%= user.id %> "><button
                                                    class="btn btn-primary">Modifier</button></a>
                                            <!-- <button button type="button" class="btn btn-danger" data-toggle="modal"
                                                data-target="#exampleModal">Delete</button>
                                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel">
                                                                Confirmation
                                                                de la
                                                                suppression
                                                            </h5>

                                                        </div>
                                                        <div class="modal-body">
                                                            es-tu s√ªr?
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-dismiss="modal">No, Annuler</button>
                                                            <a class="delete" data-doc="<%= user.id %> "><button
                                                                    class="btn btn-danger">Oui,
                                                                    Confirm&eacute;</button></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div> -->
                                            <div class="">
                                                <form action="/admin/delete-user/:<%= user.id %> " method="POST">
                                                    <input type="hidden" , name="user_id" , value="<%=user.id%>">
                                                    <button class="btn btn-danger" type="submit">Delete</button>
                                                </form>
                                            </div>

                                        </div>
                                    </td>
                                </tr>
                                <% })} else{%>
                                    <tr>
                                        <p>no users</p>
                                    </tr>
                                    <% } %>
                    </tbody>
                </table>
            </div>
            <%- include('../partiels/footer.ejs')%>
                <script>
                    const transhcan = document.querySelector('a.delete');
                    transhcan.addEventListener('click', (e) => {
                        const endpoint = `/admin/delete-user/${transhcan.dataset.doc}`
                        fetch(endpoint, {
                            method: 'DELETE'
                        })
                            .then((response) => response.json())
                            .then(data => window.location.href = data.redirect)
                            .catch(err => console.log(err))
                    })
                </script>

    </body>

</html>